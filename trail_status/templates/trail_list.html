{% extends 'base.html' %}

{% block content %}
  <div class="mb-3 p-3 bg-[#f8f9fa] border border-[#dee2e6] rounded">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-2 pb-2 border-b border-[#dee2e6]">
      <div>
        <strong class="text-gray-500 text-[0.875em]">最新の内容更新日：</strong>
        <span class="text-gray-900 font-bold">{{ updated_sources.0.latest_date|date:"Y/m/d" }}</span>
      </div>
      <div class="flex flex-wrap gap-3">
        {% for item in updated_sources %}
          <div class="text-[0.875em]">
            <a href="{{ item.source__url1 }}"
               target="_blank"
               rel="noopener"
               class="text-[#0d6efd] no-underline hover:underline">{{ item.source__name }}</a>
            <span class="text-[#6c757d] ml-1">({{ item.latest_date|date:"m/d" }})</span>
          </div>
        {% endfor %}
      </div>
      <div class="text-[#6c757d] text-[0.875em]">
        <strong class="text-gray-500">各サイト最終チェック日：</strong>
        <span class="text-gray-900">{{ latest_checked_at|date:"Y/m/d" }}</span>
      </div>
    </div>
  </div>

  <table id="trail-table"
         class="display compact cell-border w-full text-[13px] leading-[1.3] border-collapse">
    <thead class="bg-gray-50">
      <tr class="text-gray-700">
        <th class="p-[2px_4px] border text-left font-bold">サイト更新日</th>
        <th class="p-[2px_4px] border text-left font-bold">山域</th>
        <th class="p-[2px_4px] border text-left font-bold">状況種別</th>
        <th class="p-[2px_4px] border text-left font-bold">対象（山名・登山道）</th>
        <th class="p-[2px_4px] border text-left font-bold">タイトル・詳細</th>
        <th class="p-[2px_4px] border text-left font-bold">情報源</th>
      </tr>
    </thead>
    <tbody class="text-gray-800">
      {% for item in conditions %}
        <tr class="align-top border-b hover:bg-gray-50">
          <td class="p-[2px_4px] whitespace-nowrap border">{{ item.updated_at|date:"Y/m/d"|default:"-" }}</td>
          <td class="p-[2px_4px] border">{{ item.get_area_display }}</td>
          <td class="p-[2px_4px] border font-bold">
            <span class="{% if item.status == 'CLOSURE' %}text-[#d32f2f]{% elif item.status == 'HAZARD' %}text-[#f57c00]{% elif item.status == 'SNOW' %}text-[#0097a7]{% elif item.status == 'RESOLVED' %}text-[#388e3c]{% elif item.status == 'OTHER' %}text-[#616161]{% else %}text-[#1976d2]{% endif %}">
              {{ item.get_status_display }}
            </span>
          </td>
          <td class="p-[2px_4px] border">
            <div class="font-bold text-gray-900">{{ item.mountain_name_raw }}</div>
            <div class="text-gray-600">{{ item.trail_name }}</div>
          </td>
          <td class="p-[2px_4px] border">
            <div class="font-bold text-gray-900 break-all">{{ item.title }}</div>
            <div class="text-[0.85em] text-[#333] mt-1 break-all">{{ item.description }}</div>
            {% if item.comment %}
              <div class="text-[0.8em] text-[#666] border-l-2 border-[#ccc] pl-[5px] mt-1">
                備考: {{ item.comment }}
              </div>
            {% endif %}
          </td>
          <td class="p-[2px_4px] border">
            <a href="{{ item.url1 }}"
               target="_blank"
               rel="nofollow"
               class="text-[#0d6efd] hover:underline">{{ item.source.name|default:"情報元" }}</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}