{% extends 'base.html' %}
{% block content %}
  <div class="mb-3 bg-[#f8f8f8] border border-[#ddd] rounded"
       style="padding: 4px 12px">
    <div class="flex flex-col md:flex-row justify-start items-start md:items-center gap-7 pb-2 border-b border-[#ddd]">
      <div class="text-[13px] whitespace-nowrap">
        <strong style="color: #666;">æœ€æ–°ã®å†…å®¹æ›´æ–°æ—¥ï¼š</strong>
        <span style="font-weight: bold;">{{ updated_sources.0.latest_date|date:"Y/m/d" }}</span>
      </div>
      <div class="flex items-center gap-0.5">
        <div class="text-[13px] whitespace-nowrap" style="color: #666;">
          <strong>1é€±é–“ä»¥å†…ã®æ›´æ–°ï¼š</strong>
        </div>
        <div class="flex flex-wrap items-center gap-1">
          <!--ä¸€é€±é–“ä»¥å†…ã®æƒ…å ±æºã‚’è¡¨ç¤º-->
          {% for item in updated_sources %}
            {% if item.latest_date.date >= seven_days_ago %}
              <div class="text-[14px]">
                <a href="{{ item.source__url1 }}"
                   target="_blank"
                   rel="noopener"
                   style="color: #2563eb;
                          background-color: #f0f4f8;
                          padding: 2px 6px;
                          border-radius: 4px;
                          font-weight: 600;
                          text-decoration: underline">{{ item.source__name }}</a>
                <span style="color: #888; margin-left: 2px;">({{ item.latest_date|date:"m/d" }})</span>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="text-[12px]" style="color: #666;">
      <strong>å„ã‚µã‚¤ãƒˆæœ€çµ‚ãƒã‚§ãƒƒã‚¯æ—¥ï¼š</strong>
      <span style="color: #333;">{{ latest_checked_at|date:"Y/m/d" }}</span>
    </div>
  </div>
  <style>
      .mobile-hint {
          display: none;
      }

      @media (max-width: 767px) {
          .mobile-hint {
              display: block !important;
          }
      }
  </style>
  <div class="text-xs text-gray-500 mb-2 mobile-hint">ğŸ‘† å„è¡Œã‚’ã‚¿ãƒƒãƒ—ã§è©³ç´°æƒ…å ±ãƒ»æƒ…å ±æºãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º</div>
  <table id="trail-table"
         class="display compact cell-border w-full text-[13px] leading-tight nowrap"
         style="width:100%">
    <thead>
      <tr>
        <th>
          <span class="hidden md:inline">å…ƒã‚µã‚¤ãƒˆæ›´æ–°æ—¥</span>
          <span class="md:hidden">æ›´æ–°æ—¥</span>
        </th>
        <th>å±±åŸŸ</th>
        <th>å¯¾è±¡</th>
        <th>çŠ¶æ³ç¨®åˆ¥</th>
        <th>åŸæ–‡ã‚¿ã‚¤ãƒˆãƒ«ãƒ»è©³ç´°</th>
        <th>æƒ…å ±æº</th>
      </tr>
    </thead>
    <tbody>
      {% for item in conditions %}
        <tr class="hover:bg-[#f5f5f5]">
          <td class="whitespace-nowrap">
            <span class="hidden md:inline">{{ item.updated_at|date:"Y/m/d"|default:"-" }}</span>
            <span class="md:hidden">{{ item.updated_at|date:"y/m/d"|default:"-" }}</span>
          </td>
          <td>{{ item.get_area_display }}</td>
          <td>
            <div style="font-weight: bold; color: #000;">{{ item.mountain_name_raw }}</div>
            <div style="color: #666;
                        font-size: 11px;
                        white-space: nowrap;
                        overflow: hidden;
                        text-overflow: ellipsis;
                        max-width: 128px">{{ item.trail_name }}</div>
          </td>
          <td class="whitespace-nowrap" style="vertical-align: middle;">
            <span class="px-2 py-1 text-xs rounded font-medium {% if item.status == 'CLOSURE' %}bg-red-100 text-red-700 {% elif item.status == 'HAZARD' %}bg-orange-100 text-orange-700 {% elif item.status == 'SNOW' %}bg-cyan-100 text-cyan-700 {% elif item.status == 'CLEAR' %}bg-green-100 text-green-700 {% elif item.status == 'RESOLVED' %}bg-green-100 text-green-700 {% else %}bg-blue-100 text-blue-700{% endif %}">
              {{ item.get_status_display }}
            </span>
          </td>
          <td>
            <div style="font-weight: bold; color: #000;">{{ item.title }}</div>
            {% if item.comment %}
              <div class="mt-1 pl-1"
                   style="color: #777;
                          font-size: 11px;
                          border-left: 2px solid #ddd">å‚™è€ƒ: {{ item.comment }}</div>
            {% endif %}
          </td>
          <td class="whitespace-nowrap text-[#18439a]">
            <a href="{{ item.url1 }}"
               target="_blank"
               style="text-decoration: none;
                      border-bottom: 1px solid #18439a88">
              {{ item.source.name|default:"æƒ…å ±æº" }} <small style="font-size: 10px;">â†—</small>
            </a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
