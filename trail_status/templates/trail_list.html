{% extends 'base.html' %}
{% block content %}
  <div class="mb-3 info-box bg-[#f8f8f8] border border-[#ddd] rounded"
       style="padding: 4px 12px">
    <div class="flex flex-col md:flex-row justify-start items-start md:items-center gap-2 md:gap-7 pb-2 border-b border-[#ddd]">
      <div class="text-[13px] whitespace-nowrap">
        <strong style="color: #666;">æœ€æ–°ã®å†…å®¹æ›´æ–°æ—¥ï¼š</strong>
        <span style="font-weight: bold;">{{ updated_sources.0.latest_date|date:"Y/m/d" }}</span>
      </div>
      <div class="flex items-center gap-0.5">
        <div class="text-[13px] whitespace-nowrap" style="color: #666;">
          <strong>1é€±é–“ä»¥å†…ã®æ›´æ–°ï¼š</strong>
        </div>
        <div class="flex flex-wrap items-center gap-1">
          <!--ä¸€é€±é–“ä»¥å†…ã®æƒ…å ±æºã‚’è¡¨ç¤º-->
          {% if updated_sources.0.latest_date.date >= seven_days_ago %}
            {% for item in updated_sources %}
              {% if item.latest_date.date >= seven_days_ago %}
                <div class="flex items-center text-[14px]">
                  <span class="text-xs" style="color: #888; margin-left: 2px;">({{ item.latest_date|date:"m/d" }})</span>
                  <br class="md:hidden">
                  <a href="{{ item.source__url1 }}"
                     target="_blank"
                     rel="noopener"
                     style="color: #2563eb;
                            background-color: #f0f4f8;
                            padding: 2px 6px;
                            border-radius: 4px;
                            font-weight: 600;
                            text-decoration: underline">{{ item.source__name }}</a>
                </div>
              {% endif %}
            {% endfor %}
          {% else %}
            <span class="text-[13px] font-bold";>å…¨ã‚µã‚¤ãƒˆæ›´æ–°ãªã—</span>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="text-[12px]" style="color: #666;">
      <strong>å„ã‚µã‚¤ãƒˆæœ€çµ‚ãƒã‚§ãƒƒã‚¯æ—¥ï¼š</strong>
      <span style="font-weight: bold">{{ last_checked_at|date:"Y/m/d" }}</span>
    </div>
  </div>
  <style>
      .mobile-hint {
          display: none;
      }

      @media (max-width: 1024px) {
          .mobile-hint {
              display: block !important;
              margin: 0 0 2px 0;
              font-size: 11px;
              line-height: 1.2;
          }
      }
  </style>
  <div class="text-gray-500 mobile-hint">ğŸ‘† ã‚¿ãƒƒãƒ—ã§è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º</div>
  <table id="trail-table"
         class="display compact cell-border w-full text-[13px] leading-tight nowrap"
         style="width:100%">
    <thead>
      <tr>
        <th>å±±åŸŸ</th>
        <th>
          <span class="hidden md:inline">æƒ…å ±å–å¾—æ—¥</span>
          <span class="md:hidden">å–å¾—æ—¥</span>
        </th>
        <th>å ´æ‰€</th>
        <th>çŠ¶æ³ç¨®åˆ¥</th>
        <th>çŠ¶æ³</th>
        <th>è©³ç´°</th>
        <th>å ±å‘Šæ—¥</th>
        <th>è§£æ¶ˆæ—¥</th>
        <th>æƒ…å ±æº</th>
      </tr>
    </thead>
    <tbody>
      {% for item in conditions %}
        <tr class="hover:bg-[#f5f5f5]"
            data-source-created="{{ item.source.created_at.timestamp }}"
            data-record-created="{{ item.created_at.timestamp }}"
            data-record-updated="{{ item.updated_at.timestamp }}">
          <td style="white-space: normal;">{{ item.get_area_display }}</td>
          <td class="whitespace-nowrap">
            <span class="date-full">{{ item.updated_at|date:"Y/m/d" }}</span>
            <span class="date-short">{{ item.updated_at|date:"y/m/d" }}</span>
          </td>
          <td data-detail-url="{% url 'trail-detail' item.id %}" data-order="{{ item.mountain_name_raw }}">
            <a href="{% url 'trail-detail' item.id %}"
               class="hidden md:inline"
               style="font-weight: bold;
                      color: #000;
                      text-decoration: none">{{ item.mountain_name_raw }}</a>
            <span class="md:hidden" style="font-weight: bold; color: #000;">{{ item.mountain_name_raw }}</span>
            <div style="color: #666; font-size: 11px;">{{ item.trail_name }}</div>
          </td>
          <td class="whitespace-nowrap"
              style="vertical-align: middle"
              data-order="{% if item.status == 'CLOSURE' %}1{% elif item.status == 'HAZARD' %}2{% elif item.status == 'CLEAR' %}3{% elif item.status == 'ANIMAL' %}4{% elif item.status == 'WEATHER' %}5{% elif item.status == 'FACILITY' %}6{% elif item.status == 'WATER' %}7{% elif item.status == 'SNOW' %}8{% else %}9{% endif %}">
            <span class="px-1 py-1 text-xs rounded font-medium {% if item.status == 'CLOSURE' %}bg-red-100 text-red-700 {% elif item.status == 'HAZARD' %}bg-orange-100 text-orange-700 {% elif item.status == 'SNOW' %}bg-cyan-100 text-cyan-700 {% elif item.status == 'CLEAR' %}bg-green-100 text-green-700 {% elif item.status == 'RESOLVED' %}bg-green-100 text-green-700 {% elif item.status == 'ANIMAL' %}bg-purple-100 text-purple-700 {% elif item.status == 'WATER' %}bg-teal-100 text-teal-700 {% elif item.status == 'WEATHER' %}bg-gray-100 text-gray-700 {% else %}bg-blue-100 text-blue-700{% endif %}">
              {{ item.get_status_display }}
            </span>
          </td>
          <td>
            <div class="text-sm"
                 style="font-weight: bold;
                        font-style: italic;
                        color: #000">{{ item.title }}</div>
          </td>
          <td style="white-space: normal;">
            {% if item.description %}
              <div class="pl-1"
                   style="color: #444;
                          font-size: 12px;
                          border-left: 2px solid #ddd;
                          display: -webkit-box;
                          -webkit-line-clamp: 2;
                          -webkit-box-orient: vertical;
                          overflow: hidden">{{ item.description }}</div>
            {% endif %}
          </td>
          <td class="whitespace-nowrap">
            <span class="hidden md:inline">{{ item.reported_at|date:"y/m/d"|default:"-" }}</span>
            <span class="md:hidden">{{ item.reported_at|date:"y/m/d"|default:"-" }}</span>
          </td>
          <td class="whitespace-nowrap">
            <span class="hidden md:inline">{{ item.resolved_at|date:"y/m/d"|default:"-" }}</span>
            <span class="md:hidden">{{ item.resolved_at|date:"y/m/d"|default:"-" }}</span>
          </td>
          <td class="whitespace-normal overflow-hidden text-xs">
            <a href="{{ item.url1 }}"
               target="_blank"
               style="color: #18439a;
                      text-decoration: none;
                      border-bottom: 1px solid rgba(24,67,154,0.53);
                      display: inline">
              {{ item.source.name|default:"æƒ…å ±æº" }}
              <small style="font-size:10px; color:#18439a;">â†—</small>
            </a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
