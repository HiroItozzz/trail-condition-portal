# 2026-01-10 背景デザイン実装の進捗

## 実装した主な機能

### 1. 背景画像の導入と調整
- **mountain_2.webp → mountain_3.webp に変更**
- 青空部分を白いグラデーションで薄く調整
  - 上部（0%）: `rgba(240, 244, 248, 0.9)` - 趣味感を減らす
  - 40-60%: 徐々に透明に
  - 山並み部分（50%以降）: はっきり見える
- `background-attachment: fixed` でスクロール時も固定

### 2. サイドバーのガラスモルフィズムデザイン
- **複数パターンを試行**:
  - パターン1: 半透明 + ぼかし15px
  - パターン2: グラデーション + 透明
  - パターン3: 完全透明 + 影つき
  - パターン4: ホワイトカード風

- **最終採用**: 透明度50% + ぼかし15px
  - `rgba(255, 255, 255, 0.5)` + `backdrop-filter: blur(15px)`
  - 白くぼやけたガラス風の質感
  - 背景の山の写真が薄く透ける

### 3. 情報ボックスとフッターの透明化
- 情報ボックス: `rgba(255, 255, 255, 0.7)` + ぼかし10px
- フッター: `rgba(248, 249, 250, 0.2)` + ぼかし8px
- フッターを最下部固定（HTML構造変更）

### 4. レスポンシブデザインの調整
- **ブレークポイント**: 640px, 768px, 1024px, 1200px
- スマホサイズ（640px以下）:
  - テーブルの列幅調整（更新日、登山道名など）
  - ヘッダー名の切り替え（「元サイト更新日」→「更新日」）
  - フォントサイズ: 12px
  - 展開時の詳細情報スタイル調整

- **モバイルヒント表示**: 1024px以下で表示
  - 「👆 各行をタップで詳細情報・情報源リンクを表示」

### 5. テーブル表示の微調整
- **登山道名の省略幅を可変に**:
  - PC: 250px
  - タブレット（1200px以下）: 180px
  - スマホ（768px以下）: 100px

- **原文タイトルをイタリック化**
  - `font-style: italic`

- **テーブルヘッダーの色統一**
  - `color: #666` で上部情報バーと統一

- **情報源リンクの色**
  - Tailwindクラス → インラインスタイルに変更
  - `color: #18439a` で統一

---

## CSS/Tailwindで学んだこと

### 1. CSS優先順位の理解

```
最強 → 弱
1. !important がついたスタイル
2. インラインスタイル（HTML内のstyle=""）
3. IDセレクタ（#trail-table）
4. クラス・属性セレクタ（.mb-3）
5. 要素セレクタ（th, td）
```

**重要な学び**:
- **@media 自体は優先順位を変えない**
- レスポンシブでインラインスタイルを上書きするには `!important` が必要
- 同じ優先度なら後に書かれた方が適用される

---

### 2. 背景グラデーションの仕組み

```css
background-image:
  linear-gradient(to bottom,
    rgba(240, 244, 248, 0.9) 0%,   /* 上端: 白で覆う */
    rgba(248, 249, 250, 0) 50%,    /* 中央: 透明 */
    rgba(248, 249, 250, 0.95) 100% /* 下端: 白 */
  ),
  url('mountain.webp');
```

**ポイント**:
- グラデーションは背景画像の**上に重なる**
- `rgba(r, g, b, a)` の `a` で透明度を制御
- 複数の色ポイントで滑らかな変化を作れる

---

### 3. ガラスモルフィズム（Glassmorphism）

```css
background: rgba(255, 255, 255, 0.5);  /* 半透明の白 */
backdrop-filter: blur(15px);            /* ぼかし効果 */
-webkit-backdrop-filter: blur(15px);    /* Safari対応 */
```

**重要な発見**:
- **透明度よりもぼかしの視覚的影響が大きい**
- 透明度50%でも、ぼかし15pxだと「ほぼ白いガラス」に見える
- `saturate(180%)` で色の鮮やかさを強調できる

---

### 4. テキストの省略（Ellipsis）

**3つのプロパティが必須**:
```css
overflow: hidden;
white-space: nowrap;    /* 改行させない */
text-overflow: ellipsis; /* ... で省略 */
max-width: 200px;       /* 幅の制限 */
```

**overflow のオプション**:
- `visible`: はみ出しても表示
- `hidden`: はみ出したら隠す
- `scroll`: スクロールバー表示
- `auto`: 必要な時だけスクロールバー

**white-space のオプション**:
- `normal`: 通常（改行あり）
- `nowrap`: 改行させない
- `pre`: 改行・スペースをそのまま表示
- `pre-wrap`: 改行は保持、折り返しあり

---

### 5. Tailwindのレスポンシブクラス

**ブレークポイント**:
- `sm`: 640px以上
- `md`: 768px以上（タブレット・PC）← よく使う
- `lg`: 1024px以上
- `xl`: 1280px以上

**使い方**:
```html
<!-- スマホでは非表示、PCでは表示 -->
<span class="hidden md:inline">元サイト更新日</span>

<!-- スマホでは表示、PCでは非表示 -->
<span class="md:hidden">更新日</span>

<!-- スマホでは改行、PCでは改行なし -->
<br class="md:hidden">

<!-- 縦並び → 横並び -->
<div class="flex flex-col md:flex-row">
```

**重要**:
- `md:` は「md以上で適用」という意味
- モバイルファーストの考え方（デフォルト → PCで上書き）

---

### 6. DataTables Responsiveの構造

**展開された詳細情報の構造**:
```html
<tr class="child">
  <td>
    <ul class="dtr-details">
      <li>
        <span class="dtr-title">原文タイトル・詳細</span>  ← ヘッダー
        <span class="dtr-data">...</span>                  ← データ
      </li>
    </ul>
  </td>
</tr>
```

**スタイル調整**:
```css
.dtr-title {
  font-size: 10px !important;
  color: #666 !important;
}

.dtr-data {
  font-size: 11px !important;
  white-space: normal;  /* 折り返しあり */
}

.dtr-details li {
  border-bottom: 1px solid #e5e7eb;  /* 境界線 */
}
```

---

### 7. 境界線（border）のオプション

**基本形**:
```css
border-right: 1px solid #f1f1f1;
           ↑幅  ↑スタイル ↑色
```

**スタイルのバリエーション**:
- `solid`: 実線
- `dashed`: 破線
- `dotted`: 点線
- `double`: 二重線
- `none`: なし

**方向**:
- `border`: 全方向
- `border-top`: 上のみ
- `border-right`: 右のみ
- `border-bottom`: 下のみ
- `border-left`: 左のみ

---

### 8. インラインスタイル vs Tailwindクラス

**Tailwindクラスが効かない場合の対処法**:

1. **インラインスタイルに変更**（確実）:
```html
<!-- 効かない -->
<td class="text-[#18439a]">

<!-- 効く -->
<td style="color: #18439a;">
```

2. **CSSで !important 上書き**:
```css
.text-\[#18439a\] {
  color: #18439a !important;
}
```

**使い分け**:
- **静的な表示**: Tailwindクラス（メンテナンスしやすい）
- **動的生成（DataTables等）**: インラインスタイル or CSS（確実）
- **レスポンシブ調整**: CSS（一括管理）

---

### 9. メディアクエリのネスト注意

**❌ 間違い（二重ネスト）**:
```css
@media (max-width: 768px) {
    /* ... */

    @media (max-width: 768px) {  /* ← 二重ネスト */
        /* 効かない！ */
    }
}
```

**✅ 正しい**:
```css
@media (max-width: 768px) {
    .hamburger { ... }
    #sidebar { ... }
    #trail-table td { ... }  /* 全て同じレベル */
}
```

---

## ブラウザキャッシュの問題と解決

### 画像変更が反映されない理由
1. ブラウザがキャッシュしている
2. `background-attachment: fixed` は特にキャッシュされやすい

### 解決方法
1. **ハードリロード**（最も簡単）:
   - Windows/Linux: `Ctrl + Shift + R`
   - Mac: `Cmd + Shift + R`

2. **開発者ツールでキャッシュ無効化**:
   - F12 → Networkタブ → "Disable cache"

3. **シークレットモードで確認**

4. **ファイル名を変更**（確実）:
   ```css
   url('mountain_2.webp?v=2')  /* バージョン番号追加 */
   url('mountain_3.webp')      /* 新しいファイル名 */
   ```

---

## トラブルシューティング

### 問題1: サイドバーとメインのスカイラインがズレる
**原因**: `background-position` と `background-attachment` の設定が違う

**解決**:
```css
/* bodyとサイドバーで統一 */
background-position: center top;
background-attachment: fixed;
```

---

### 問題2: フッターがテーブルにくっつく
**原因**: フッターが `#content` の中にあり、`#sidebar` が `height: 100vh`

**解決**:
1. フッターを `#content` の外に移動（HTML構造変更）
2. `#sidebar` の `height: auto` に変更

---

### 問題3: 透明度が反映されない
**原因**: サイドバーの背後に背景画像がない（構造上の問題）

**解決**:
```css
/* サイドバー自体に背景画像を配置 */
#sidebar {
    background-image: url('mountain.webp');
}

/* 半透明レイヤーを重ねる */
#sidebar::before {
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(15px);
}
```

---

### 問題4: レスポンシブのヒント表示タイミングがズレる
**原因**: DataTablesの折りたたみタイミング（自動）とメディアクエリ（767px）がズレる

**解決**:
```css
/* 早めに表示 */
@media (max-width: 1024px) {  /* 767px → 1024px */
    .mobile-hint {
        display: block !important;
    }
}
```

---

## 次回への引き継ぎ

### 現在のブランチ状態
- **ブランチ名**: `claude/update-background-skyline-0DGLt`
- **ベース**: `develop`
- **最新コミット**: f51a200

### 完了した項目
- ✅ 背景画像の導入と調整
- ✅ サイドバーのガラスモルフィズム実装
- ✅ 情報ボックス・フッターの透明化
- ✅ レスポンシブデザインの調整
- ✅ テーブル表示の微調整

### 残課題（もしあれば）
- 特になし（ユーザーの要望次第）

---

## 参考資料

### CSS関連
- グラデーション: `linear-gradient(to bottom, color1 0%, color2 100%)`
- ガラスモルフィズム: `backdrop-filter: blur(Npx)`
- 省略表示: `overflow + white-space + text-overflow`

### Tailwind関連
- ブレークポイント: `md:` = 768px以上
- レスポンシブ切り替え: `hidden md:inline` / `md:hidden`
- Flexbox: `flex flex-col md:flex-row`

### DataTables関連
- Responsive構造: `.dtr-title`, `.dtr-data`, `.dtr-details`
- カラム優先度: `responsivePriority: 1` (重要) / `10000` (折りたたむ)

---

作成日: 2026-01-10
