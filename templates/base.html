<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>
            {% block title %}ãƒˆãƒ¬ã‚¤ãƒ«ã‚¤ãƒ³ãƒ•ã‚© - ç™»å±±é“çŠ¶æ³ã¾ã¨ã‚{% endblock %}
        </title>
        <meta name="description"
              content="å¥¥å¤šæ‘©ãƒ»ä¸¹æ²¢ç­‰ã®ç™»å±±é“å±é™ºæƒ…å ±ã‚’å…¬çš„æ©Ÿé–¢ã‹ã‚‰è‡ªå‹•åé›†ã€‚é€šè¡Œæ­¢ã‚ãƒ»è½çŸ³ãƒ»ç©é›ªç­‰ã®æœ€æ–°çŠ¶æ³ã‚’ã¾ã¨ã‚ã¦ç¢ºèªã§ãã¾ã™ã€‚">
        <!-- OGã‚¿ã‚° (SNSã‚·ã‚§ã‚¢ç”¨) -->
        <meta property="og:title"
              content="{% block og_title %}ãƒˆãƒ¬ã‚¤ãƒ«ã‚¤ãƒ³ãƒ•ã‚© - ç™»å±±é“çŠ¶æ³ã¾ã¨ã‚{% endblock %}">
        <meta property="og:description"
              content="å¥¥å¤šæ‘©ãƒ»ä¸¹æ²¢ç­‰ã®ç™»å±±é“å±é™ºæƒ…å ±ã‚’å…¬çš„æ©Ÿé–¢ã‹ã‚‰è‡ªå‹•åé›†ã€‚é€šè¡Œæ­¢ã‚ãƒ»è½çŸ³ãƒ»ç©é›ªç­‰ã®æœ€æ–°çŠ¶æ³ã‚’ã¾ã¨ã‚ã¦ç¢ºèªã§ãã¾ã™ã€‚">
        <meta property="og:type" content="website">
        <meta property="og:url"
              content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
        <meta property="og:site_name" content="ãƒˆãƒ¬ã‚¤ãƒ«ã‚¤ãƒ³ãƒ•ã‚© - ç™»å±±é“çŠ¶æ³ã¾ã¨ã‚">
        <meta property="og:locale" content="ja_JP">
        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:title"
              content="{% block twitter_title %}ãƒˆãƒ¬ã‚¤ãƒ«ã‚¤ãƒ³ãƒ•ã‚© - ç™»å±±é“çŠ¶æ³ã¾ã¨ã‚{% endblock %}">
        <meta name="twitter:description"
              content="å¥¥å¤šæ‘©ãƒ»ä¸¹æ²¢ç­‰ã®ç™»å±±é“å±é™ºæƒ…å ±ã‚’å…¬çš„æ©Ÿé–¢ã‹ã‚‰è‡ªå‹•åé›†ã€‚é€šè¡Œæ­¢ã‚ãƒ»è½çŸ³ãƒ»ç©é›ªç­‰ã®æœ€æ–°çŠ¶æ³ã‚’ã¾ã¨ã‚ã¦ç¢ºèªã§ãã¾ã™ã€‚">
        <link rel="icon"
              href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”ï¸</text></svg>">
            <link rel="stylesheet"
                  href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
            <link rel="stylesheet"
                  href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
            {% load static %}
            <link rel="stylesheet" href="{% static 'dist/main.css' %}">
            <style>
                /* å…¨ä½“ã®åŸºæœ¬è¨­å®š */
                body {
                    display: flex;
                    flex-direction: column;
                    min-height: 100vh;
                    margin: 0;
                    font-family: sans-serif;
                    color: #333;
                    background-color: #f8f9fa;
                    background-image: linear-gradient(to bottom,
                        rgba(240, 244, 248, 0.9) 0%,
                        rgba(248, 249, 250, 0.85) 40%,
                        rgba(248, 249, 250, 0.65) 50%,
                        rgba(248, 249, 250, 0.7) 60%,
                        rgba(248, 249, 250, 0.7) 70%,
                        rgba(248, 249, 250, 0.9) 80%,
                        rgba(248, 249, 250, 0.95) 90%,
                        rgba(248, 249, 250, 1) 95%,
                        rgba(248, 249, 250, 1) 100%),
                    url('{% static "mountain.webp" %}');
                    background-size: cover;
                    background-position: center top;
                    background-repeat: no-repeat;
                    background-attachment: fixed;
                }

                .main-content {
                    display: flex;
                    flex: 1;
                }

                /* æ´—ç·´ã•ã›ãŸã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šé€æ˜åº¦50% + ã¼ã‹ã—15pxï¼ˆæ¡ç”¨ç‰ˆï¼‰ */
                #sidebar {
                    width: 246px;
                    height: 100vh;
                    padding: 24px 20px;
                    border-right: 1px #f1f1f1;
                    overflow-y: auto;
                    flex-shrink: 0;
                    position: sticky;
                    top: 0;
                    background-image: url('{% static "mountain.webp" %}');
                    background-size: cover;
                    background-position: center top;
                    background-attachment: fixed;
                    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
                    isolation: isolate;
                }

                /* ãƒœãƒ‡ã‚£ç”¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
                html {
                    scrollbar-width: thin;
                }

                html::-webkit-scrollbar {
                    width: 6px;
                }

                html::-webkit-scrollbar-thumb {
                    background: rgba(150, 150, 150, 0.4);
                    border-radius: 3px;
                }

                /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ç”¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
                #sidebar {
                    scrollbar-width: thin;
                    scrollbar-color: rgba(145, 145, 145, 0.5) rgb(245, 245, 245);
                }

                #sidebar::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: var(--sidebar-height, 100vh);
                    min-height: 100vh;
                    background: rgba(255, 255, 255, 0.5);
                    backdrop-filter: blur(15px) saturate(180%);
                    -webkit-backdrop-filter: blur(15px) saturate(180%);
                    z-index: 0;
                    pointer-events: none;
                    transform: translateZ(0);
                    will-change: backdrop-filter;
                }

                #sidebar>* {
                    position: relative;
                    z-index: 1;
                }

                /* ã‚µã‚¤ãƒ‰ãƒãƒ¼å†…ã®æ–‡å­—è¦ç´  */
                #sidebar h3 {
                    font-size: 12px;
                    font-weight: 700;
                    color: #9ca3af;
                    text-transform: uppercase;
                    letter-spacing: 0.1em;
                    margin: 24px 0 12px;
                }

                .sidebar-link {
                    display: block;
                    padding: 4px 0;
                    font-size: 14px;
                    color: #4b5563;
                    text-decoration: none;
                    transition: color 0.2s;
                }


                .logo-link:hover {
                    background-color: rgba(255, 255, 255, 0.4);
                }

                .sidebar-link:hover {
                    color: #2563eb;
                    text-decoration: underline;
                }

                .sidebar-link.active {
                    font-weight: bold;
                    color: #2563eb;
                }

                hr {
                    border: 0;
                    border-top: 1px solid #f1f1f1;
                    margin: 16px 0;
                }

                #content {
                    flex: 1;
                    padding: 20px;
                    overflow-y: auto;
                    overflow-x: auto;
                    display: flex;
                    flex-direction: column;
                    min-height: 100vh;
                    min-width: 0;
                }



                /* æƒ…å ±ãƒœãƒƒã‚¯ã‚¹ã¨ãƒ•ãƒƒã‚¿ãƒ¼ã®é€æ˜åŒ– */
                #content .mb-3 {
                    background: rgba(255, 255, 255, 0.7) !important;
                    backdrop-filter: blur(10px);
                    -webkit-backdrop-filter: blur(10px);
                }

                footer {
                    background: rgba(248, 249, 250, 0.2) !important;
                    backdrop-filter: blur(8px) saturate(180%);
                    -webkit-backdrop-filter: blur(8px) saturate(180%);
                    margin-top: auto;
                }

                /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ã®é«˜ã•èª¿æ•´ */
                .inline-flex.items-center {
                    padding: 2px 8px !important;
                    line-height: 1.2;
                }

                /* DataTablesãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ */
                .datatable-header {
                    display: flex;
                    flex-wrap: wrap;
                    justify-content: space-between;
                    align-items: center;
                    gap: 8px;
                    margin-bottom: 0.75rem;
                }

                .dt-row1 {
                    display: flex;
                    align-items: center;
                    gap: 16px;
                }

                .dt-row2 {
                    display: flex;
                    align-items: center;
                    gap: 16px;
                    margin-left: auto;
                    flex: 1;
                    justify-content: flex-end;
                }

                @media (max-width: 1023px) {
                    .datatable-header {
                        flex-direction: column;
                        align-items: stretch;
                        gap: 2px;
                        margin-bottom: 4px;
                    }

                    .dt-row1 {
                        width: 100%;
                    }

                    .dt-row2 {
                        width: 100%;
                        justify-content: space-between;
                        margin-left: 0;
                        gap: 8px;
                    }

                    .dt-row2 .dataTables_length {
                        display: none;
                    }

                    #sort-select {
                        background: white;
                        font-size: 12px;
                        height: 24px;
                        padding: 0 4px;
                        min-width: 90px;
                    }
                }

                /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆ1024pxä»¥ä¸Šï¼‰ */
                @media (min-width: 1024px) {
                    .dt-row2 {
                        justify-content: flex-start;
                    }

                    #sort-select {
                        background: white;
                        font-size: 13px;
                        height: 26px;
                        padding: 2px 6px;
                        min-width: 100px;
                    }

                    /* Xä»¶è¡¨ç¤ºã‚’å³å´ã«é…ç½® */
                    .dt-row2 .dataTables_length {
                        display: block;
                        margin-left: auto;
                    }
                }

                /* DataTableså…¥åŠ›æ¬„ã®ã‚¹ã‚¿ã‚¤ãƒ« */
                .dataTables_filter,
                .dataTables_length {
                    font-size: 14px !important;
                }

                .dataTables_filter input,
                .dataTables_length select {
                    background: white !important;
                    border: 1px solid #ddd !important;
                    border-radius: 4px !important;
                    padding: 2px 6px !important;
                    height: 28px !important;
                }

                .dataTables_filter input {
                    width: 160px !important;
                }

                @media (max-width: 1023px) {
                    .dataTables_filter input {
                        width: 128px !important;
                    }

                    .dt-row2 {
                        font-size: 12px !important;
                    }

                    .dt-row2 .resolved-filter label {
                        font-size: 12px;
                    }

                    .dt-row2 .dataTables_length {
                        font-size: 12px !important;
                    }

                    .dt-row2 select {
                        height: 24px !important;
                        font-size: 12px !important;
                    }
                }

                /* ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®è‰²ã‚’çµ±ä¸€ */
                #trail-table th {
                    font-size: 12px;
                    color: #666;
                }

                /* æƒ…å ±å–å¾—æ—¥ã®è¡¨ç¤ºåˆ‡æ›¿: 1280pxä»¥ä¸Šã§YYYY/MM/DDã€ãã‚Œä»¥ä¸‹ã§yy/m/d */
                .date-full { display: none; }
                .date-short { display: inline; }
                @media (min-width: 1280px) {
                    .date-full { display: inline; }
                    .date-short { display: none; }
                }

                /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç¯„å›²ã®ã¿ï¼ˆ1024pxã€œ1279pxï¼‰: å›ºå®šå¹…ã§å®‰å®šã•ã›ã‚‹ */
                @media (min-width: 1024px) and (max-width: 1279px) {
                    /* å±±åŸŸ: å›ºå®šå¹… */
                    #trail-table th:nth-child(1),
                    #trail-table td:nth-child(1) {
                        width: 50px !important;
                        min-width: 50px !important;
                        max-width: 50px !important;
                    }

                    /* æƒ…å ±å–å¾—æ—¥: å›ºå®šå¹… */
                    #trail-table th:nth-child(2),
                    #trail-table td:nth-child(2) {
                        width: 54px !important;
                        min-width: 54px !important;
                        max-width: 54px !important;
                    }

                    /* å¯¾è±¡: æ®‹ã‚Šå¹…ã‚’ä½¿ç”¨ */
                    #trail-table th:nth-child(3),
                    #trail-table td:nth-child(3) {
                        width: auto !important;
                        min-width: 120px !important;
                    }

                    /* çŠ¶æ³ç¨®åˆ¥ï¼ˆãƒãƒƒã‚¸ï¼‰: å›ºå®šå¹… */
                    #trail-table th:nth-child(4),
                    #trail-table td:nth-child(4) {
                        width: 65px !important;
                        min-width: 65px !important;
                        max-width: 65px !important;
                    }
                }

                /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®ã¿: ãƒ†ãƒ¼ãƒ–ãƒ«å¹…å›ºå®šï¼ˆãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ï¼‰ */
                @media (min-width: 641px) {
                    #trail-table {
                        table-layout: fixed;
                    }

                    /* å±±åŸŸ */
                    #trail-table th:nth-child(1),
                    #trail-table td:nth-child(1) {
                        width: 6%;
                    }

                    /* æƒ…å ±å–å¾—æ—¥: 1280pxä»¥ä¸Šã§ã¯7%ã€ãã‚Œæœªæº€ã¯åˆ¥ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªã§54pxå›ºå®š */
                    #trail-table th:nth-child(2),
                    #trail-table td:nth-child(2) {
                        width: 7%;
                    }

                    /* å¯¾è±¡ */
                    #trail-table th:nth-child(3),
                    #trail-table td:nth-child(3) {
                        width: 15%;
                        min-width: 120px;
                        white-space: normal;
                        word-break: break-word;
                    }

                    /* çŠ¶æ³ç¨®åˆ¥ï¼ˆãƒãƒƒã‚¸ï¼‰ */
                    #trail-table th:nth-child(4),
                    #trail-table td:nth-child(4) {
                        width: 65px !important;
                        min-width: 65px !important;
                        max-width: 65px !important;
                    }

                    /* çŠ¶æ³ */
                    #trail-table th:nth-child(5),
                    #trail-table td:nth-child(5) {
                        width: 18%;
                    }

                    /* åŸæ–‡ã‚¿ã‚¤ãƒˆãƒ« */
                    #trail-table th:nth-child(6),
                    #trail-table td:nth-child(6) {
                        width: 25%;
                    }

                    /* å ±å‘Šæ—¥ */
                    #trail-table th:nth-child(7),
                    #trail-table td:nth-child(7) {
                        width: 50px;
                        text-align: center;
                    }

                    /* è§£æ¶ˆæ—¥ */
                    #trail-table th:nth-child(8),
                    #trail-table td:nth-child(8) {
                        width: 50px;
                        text-align: center;
                    }

                    /* æƒ…å ±æº */
                    #trail-table th:nth-child(9),
                    #trail-table td:nth-child(9) {
                        width: 11%;
                    }

                    /* å¯¾è±¡ã®ç™»å±±é“åãƒ»åŸæ–‡ã‚’çœç•¥ */
                    #trail-table td:nth-child(3) div,
                    #trail-table td:nth-child(5) div {
                        overflow: hidden;
                        text-overflow: ellipsis;
                        white-space: nowrap;
                    }
                }

                /* 1280pxä»¥ä¸Š: æƒ…å ±æºã®æŠ˜ã‚Šè¿”ã—æœ‰åŠ¹ */
                @media (min-width: 1280px) {
                    #trail-table td:nth-child(9) {
                        white-space: normal;
                        word-break: break-word;
                    }
                }

                /* å±•é–‹ã•ã‚ŒãŸè©³ç´°æƒ…å ±ã®ãƒ˜ãƒƒãƒ€ãƒ¼*/
                .dtr-title {
                    font-size: 12px;
                    color: #666;
                }

                /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒ«ã®å‚ç›´é…ç½® */
                #trail-table td {
                    vertical-align: middle;
                    padding-top: 6px !important;
                    padding-bottom: 6px !important;
                }

                /* åŸæ–‡ã‚¿ã‚¤ãƒˆãƒ«ãƒ»è©³ç´°æ¬„ã®å¹…ã‚’ç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ã¦èª¿æ•´ */
                /* 1024pxä»¥ä¸Šã®ã¿max-widthåˆ¶é™ã‚’é©ç”¨ */
                @media (min-width: 1024px) and (max-width: 1200px) {
                    #trail-table td>div[style*="border-left: 2px solid #ddd"] {
                        white-space: normal;
                        max-width: 180px !important;
                    }
                }

                /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒœã‚¿ãƒ³ */
                .hamburger {
                    display: none;
                    background: none;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    padding: 4px 8px;
                    position: fixed;
                    bottom: 20px;
                    left: 16px;
                    z-index: 1000;
                    background-color: rgba(255, 255, 255, 0.5);
                    backdrop-filter: blur(4px);
                    -webkit-backdrop-filter: blur(4px);
                    border-radius: 4px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                }

                /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
                @media (max-width: 1023px) {
                    .hamburger {
                        display: block;
                    }

                    #sidebar {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 250px;
                        height: 100vh;
                        overflow-y: auto;
                        overflow-x: hidden;
                        transform: translateX(-100%);
                        transition: transform 0.3s ease;
                        z-index: 999;
                        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
                        background-image: url('{% static "mountain.webp" %}');
                        background-size: cover;
                        background-position: center top;
                        background-attachment: scroll;
                        isolation: isolate;
                    }

                    #sidebar::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: var(--sidebar-height, 100vh);
                        min-height: 100vh;
                        background: rgba(255, 255, 255, 0.6);
                        backdrop-filter: blur(15px) saturate(180%);
                        -webkit-backdrop-filter: blur(15px) saturate(180%);
                        transform: translateZ(0);
                        will-change: backdrop-filter;
                        z-index: 0;
                        pointer-events: none;
                    }

                    #sidebar.open {
                        transform: translateX(0);
                    }

                    #content {
                        margin-left: 0;
                        padding: 16px;
                    }

                    /* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
                    .overlay {
                        display: none;
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background-color: rgba(0, 0, 0, 0.5);
                        z-index: 998;
                    }

                    .overlay.show {
                        display: block;
                    }


                    #trail-table th {
                        font-size: 10px;
                        color: #666;

                        padding: 4px 2px !important;

                    }

                    /* å±•é–‹ã•ã‚ŒãŸè©³ç´°æƒ…å ±ã®ãƒ˜ãƒƒãƒ€ãƒ¼*/
                    .dtr-title {
                        font-size: 10px;
                        color: #666;
                        font-weight: bold;
                    }

                    /* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆthï¼‰ã‚‚å¼·åˆ¶çš„ã«ç‹­ãã™ã‚‹ */
                    #trail-table th {
                        max-width: 50px !important;
                        /* æœ€å¤§å¹…ã‚’åˆ¶é™ */
                        overflow: hidden;
                        /* ã¯ã¿å‡ºã—ãŸã‚‰éš ã™ */
                        text-overflow: ellipsis;
                        /* ... ã§çœç•¥ */
                        white-space: nowrap;
                        /* æ”¹è¡Œã•ã›ãªã„ */
                    }

                    /* 1åˆ—ç›®ï¼ˆæ›´æ–°æ—¥ï¼‰ã ã‘ç‰¹ã«ç‹­ã */
                    #trail-table th:nth-child(1),
                    #trail-table td:nth-child(1) {
                        max-width: 54px !important;
                    }

                    /* 3åˆ—ç›®ï¼ˆå‚™è€ƒï¼‰ã¯ç•³ã¾ã‚Œã™ããªã„ã‚ˆã†ã« */
                    #trail-table th:nth-child(3),
                    #trail-table td:nth-child(3) {
                        white-space: normal;
                        max-width: 124px !important;
                        min-width: 100px !important;
                    }

                    /* å±•é–‹æ™‚ã®ãƒ†ã‚­ã‚¹ãƒˆæŠ˜ã‚Šè¿”ã— */
                    .dtr-data {
                        white-space: normal;
                        word-break: break-word;
                    }

                    /* ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œã®ã‚«ãƒ¼ã‚½ãƒ« */
                    #trail-table tbody tr {
                        cursor: pointer;
                        transition: background-color 0.2s ease;
                    }


                    .inline-flex.items-center {
                        padding: 2px 8px !important;
                        line-height: 1.2;
                    }

                    /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒ«ã®å‚ç›´é…ç½® */
                    #trail-table td {
                        vertical-align: middle;
                        padding-top: 8px !important;
                        padding-bottom: 8px !important;
                    }
                }
            </style>
        </head>
        <body>
            <button class="hamburger" id="hamburger">â˜°</button>
            <div class="overlay" id="overlay"></div>
            <div class="main-content">
                <aside id="sidebar">
                    <a href="{% url 'trail-list' %}"
                       class="logo-link block p-4 no-underline transition-colors rounded-lg">
                        <h1 class="text-xl font-black tracking-tighter text-blue-900"
                            style="width: fit-content">
                            ãƒˆãƒ¬ã‚¤ãƒ«ã‚¤ãƒ³ãƒ•ã‚©
                            <span class="block text-center text-sm font-medium tracking-normal text-gray-500">ç™»å±±é“çŠ¶æ³ã¾ã¨ã‚</span>
                        </h1>
                    </a>
                    <hr>
                    <div class="mb-6">
                        <a href="{% url 'trail-list' %}"
                           class="sidebar-link {% if not current_source and not current_area and not current_status %}active{% endif %}"
                           style="font-size: 14px">ã™ã¹ã¦ã®æƒ…å ±ã‚’è¡¨ç¤º</a>
                    </div>
                    <nav>
                        {% if source_choices %}
                            <h3>ã‚µã‚¤ãƒˆåˆ¥</h3>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                {% for id, name in source_choices %}
                                    <li>
                                        <a href="{% url 'trail-list' %}?source={{ id|stringformat:'s' }}"
                                           class="sidebar-link {% if current_source == id %}active{% endif %}">{{ name }}</a>
                                    </li>
                                {% endfor %}
                            </ul>
                            <hr>
                        {% endif %}
                        {% if area_choices %}
                            <h3>å±±åŸŸåˆ¥</h3>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                {% for id, name in area_choices %}
                                    <li>
                                        <a href="{% url 'trail-list' %}?area={{ id }}"
                                           class="sidebar-link {% if current_area == id %}active{% endif %}">{{ name }}</a>
                                    </li>
                                {% endfor %}
                            </ul>
                            <hr>
                        {% endif %}
                        {% if status_choices %}
                            <h3>çŠ¶æ³åˆ¥</h3>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                {% for id, name in status_choices %}
                                    <li>
                                        <a href="{% url 'trail-list' %}?status={{ id }}"
                                           class="sidebar-link {% if current_status == id %}active{% endif %}">{{ name }}</a>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </nav>
                </aside>
                <main id="content">
                    {% block content %}{% endblock %}
                    <footer class="bg-gray-50 border-t border-gray-200 mt-8">
                        <div class="mx-auto">
                            <div class="flex gap-4 justify-end text-xs text-gray-600"
                                 style="text-align: center">
                                <a href="/site-policy/" class="hover:text-blue-600 transition-colors">ã‚µã‚¤ãƒˆãƒãƒªã‚·ãƒ¼</a>
                                <span class="text-gray-500">å®‰å…¨ãªç™»å±±ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ ğŸ”ï¸</span>
                                <span>&copy; 2026 ãƒˆãƒ¬ã‚¤ãƒ«ã‚¤ãƒ³ãƒ•ã‚©</span>
                            </div>
                        </div>
                    </footer>
                </div>
                <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
                <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
                <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
                <script>
                    $(document).ready(function() {
                        console.log('jQueryç‰ˆ:', $.fn.jquery);
                        console.log('DataTablesæœ‰ç„¡:', !!$.fn.DataTable);
                        console.log('Responsiveæœ‰ç„¡:', !!$.fn.DataTable.Responsive);

                        // ç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ãŸä»¶æ•°è¨­å®š
                        const isMobile = window.innerWidth <= 768;
                        const pageLength = isMobile ? 20 : 15;

                        var table = $('#trail-table').DataTable({
                            "dom": '<"datatable-header"<"dt-row1"f><"dt-row2"<"resolved-filter">l>>rtip',
                            "order": [
                                [6, "desc"]
                            ],
                            "language": {
                                "url": "https://cdn.datatables.net/plug-ins/1.13.6/i18n/ja.json"
                            },
                            "pageLength": pageLength,
                            "lengthMenu": [
                                [10, 15, 20, 50],
                                [10, 15, 20, 50]
                            ],
                            "autoWidth": false,
                            "scrollX": false,
                            "responsive": {
                                "details": {
                                    "type": "column",
                                    "target": "tr",
                                    "renderer": function(api, rowIdx, columns) {
                                        // è¡Œã‹ã‚‰è©³ç´°URLã‚’å–å¾—
                                        var row = api.row(rowIdx).node();
                                        var detailUrl = $(row).find('td[data-detail-url]').data('detail-url');

                                        var data = '';
                                        var sourceColumn = ''; // æƒ…å ±æºã‚«ãƒ©ãƒ ã‚’æœ€å¾Œã«

                                        $.each(columns, function(i, col) {
                                            if (col.hidden) {
                                                var item = '';
                                                var liStyle = 'padding: 2px 0;';
                                                if (col.columnIndex === 8) { // æƒ…å ±æº
                                                    sourceColumn = '<li data-dtr-index="' + col.columnIndex + '" style="' + liStyle + '">' +
                                                        '<span class="dtr-title">' + col.title + '</span> ' +
                                                        '<span class="dtr-data">' + col.data + '</span>' +
                                                        '</li>';
                                                } else {
                                                    item = '<li data-dtr-index="' + col.columnIndex + '" style="' + liStyle + '">' +
                                                        '<span class="dtr-title">' + col.title + '</span> ' +
                                                        '<span class="dtr-data">' + col.data + '</span>' +
                                                        '</li>';
                                                }
                                                data += item;
                                            }
                                        });

                                        // æƒ…å ±æºã‚’æœ€å¾Œã«è¿½åŠ 
                                        data += sourceColumn;

                                        if (!data) return false;

                                        // å±•é–‹ã‚¨ãƒªã‚¢å…¨ä½“ã‚’ãƒ©ãƒƒãƒ—ã—ã€å³ä¸Šã«ã€Œã‚‚ã£ã¨è¦‹ã‚‹ã€ã‚’é…ç½®
                                        var wrapper = $('<div style="position: relative;"></div>');
                                        if (detailUrl) {
                                            wrapper.append('<a href="' + detailUrl + '" style="position: absolute; top: 2px; right: 0; color: #2563eb; font-weight: 500; font-size: 13px;">ã‚‚ã£ã¨è¦‹ã‚‹ â†’</a>');
                                        }
                                        wrapper.append($('<ul data-dtr-index="' + rowIdx + '" style="margin: 0; padding: 0 70px 0 0;" />').append(data));
                                        return wrapper;
                                    }
                                }
                            },
                            "columnDefs": [{
                                    "responsivePriority": 1,
                                    "targets": [0, 2, 3]
                                }, // å±±åŸŸã€å¯¾è±¡ã€çŠ¶æ³ç¨®åˆ¥ (æœ€é‡è¦3åˆ—)
                                {
                                    "responsivePriority": 2,
                                    "targets": [1]
                                }, // å–å¾—æ—¥
                                {
                                    "responsivePriority": 10000,
                                    "targets": [4, 5, 6, 8]
                                }, // çŠ¶æ³ã€è©³ç´°ã€å ±å‘Šæ—¥ã€æƒ…å ±æºã¯æŠ˜ã‚ŠãŸãŸã¿
                                {
                                    "responsivePriority": 10001,
                                    "targets": [7]
                                }, // è§£æ¶ˆæ—¥ã¯æœ€åˆã«æŠ˜ã‚ŠãŸãŸã¿
                                {
                                    "width": "55px",
                                    "targets": 0,
                                    "className": "text-center"
                                }, // å±±åŸŸ
                                {
                                    "width": "60px",
                                    "targets": 1,
                                    "className": "text-center"
                                }, // å–å¾—æ—¥
                                {
                                    "width": "65px",
                                    "targets": 3,
                                    "className": "text-center"
                                } // çŠ¶æ³
                            ],
                            "initComplete": function() {
                                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’DOMã«æŒ¿å…¥
                                $('.resolved-filter').html(
                                    '<label class="flex items-center gap-1.5 text-sm text-gray-600 cursor-pointer whitespace-nowrap">' +
                                    '<input type="checkbox" id="hide-resolved" class="w-4 h-4 rounded" checked>' +
                                    '<span>è§£æ¶ˆæ¸ˆé™¤ã</span>' +
                                    '</label>'
                                );
                                // ã‚½ãƒ¼ãƒˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’è¿½åŠ ï¼ˆå…¨ç”»é¢ã‚µã‚¤ã‚ºå…±é€šï¼‰
                                $('.dt-row2').append(
                                    '<div class="sort-dropdown">' +
                                    '<select id="sort-select" class="text-sm border border-gray-300 rounded px-2 py-1">' +
                                    '<option value="">ä¸¦ã³æ›¿ãˆ</option>' +
                                    '<option value="6-desc">å ±å‘Šæ—¥â†“æ–°</option>' +
                                    '<option value="6-asc">å ±å‘Šæ—¥â†‘å¤</option>' +
                                    '<option value="7-desc">è§£æ¶ˆæ—¥â†“æ–°</option>' +
                                    '<option value="7-asc">è§£æ¶ˆæ—¥â†‘å¤</option>' +
                                    '<option value="8-asc">æƒ…å ±æºâ†‘</option>' +
                                    '<option value="8-desc">æƒ…å ±æºâ†“</option>' +
                                    '</select>' +
                                    '</div>'
                                );
                            }
                        });

                        // è§£æ¶ˆæ¸ˆã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                        var hideResolved = true;
                        $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                            if (!hideResolved) return true;

                            var resolvedAt = data[7] || '';

                            // æ•°å­—ãŒãªã‘ã‚Œã°è¡¨ç¤ºï¼ˆè§£æ¶ˆæ—¥ãªã—ï¼‰
                            if (!/\d/.test(resolvedAt)) return true;

                            // æ—¥ä»˜ãƒ‘ãƒ¼ã‚¹
                            var m = resolvedAt.match(/(\d{2})\/(\d{2})\/(\d{2})/);
                            if (!m) return true;

                            var resolved = new Date(2000 + +m[1], +m[2] - 1, +m[3]);
                            var today = new Date();
                            today.setHours(0, 0, 0, 0);

                            return resolved > today;
                        });

                        $(document).on('change', '#hide-resolved', function() {
                            hideResolved = this.checked;
                            table.draw();
                        });

                        // ã‚½ãƒ¼ãƒˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³
                        $(document).on('change', '#sort-select', function() {
                            var val = $(this).val();
                            if (val) {
                                var parts = val.split('-');
                                var col = parseInt(parts[0]);
                                var dir = parts[1];
                                table.order([col, dir]).draw();
                            }
                        });

                        // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§è¡Œã‚¯ãƒªãƒƒã‚¯æ™‚ã«è©³ç´°ãƒšãƒ¼ã‚¸ã¸é·ç§»
                        // DataTablesæŠ˜ã‚ŠãŸãŸã¿é–¾å€¤ï¼ˆ1441pxï¼‰ã‚ˆã‚Šå¤§ãã„å ´åˆã®ã¿é·ç§»
                        $('#trail-table tbody').on('click', 'tr', function(e) {
                            // ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯æ™‚ã¯é€šå¸¸ã®é·ç§»ã‚’è¨±å¯
                            if ($(e.target).is('a') || $(e.target).closest('a').length) {
                                return;
                            }
                            // 1442pxä»¥ä¸Šã®ã¿é·ç§»ï¼ˆãã‚Œä»¥ä¸‹ã¯DataTablesã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã«ä»»ã›ã‚‹ï¼‰
                            if (window.innerWidth >= 1442) {
                                var detailUrl = $(this).find('td[data-detail-url]').data('detail-url');
                                if (detailUrl) {
                                    window.location.href = detailUrl;
                                }
                            }
                        });

                        // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§è¡Œã«ã‚«ãƒ¼ã‚½ãƒ«ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚’è¡¨ç¤º
                        if (window.innerWidth >= 1442) {
                            $('#trail-table tbody tr').css('cursor', 'pointer');
                        }

                        // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼
                        const hamburger = document.getElementById('hamburger');
                        const sidebar = document.getElementById('sidebar');
                        const overlay = document.getElementById('overlay');

                        function toggleSidebar() {
                            sidebar.classList.toggle('open');
                            overlay.classList.toggle('show');
                            // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‹ã„ã¦ã„ã‚‹ã¨ãã¯æœ¬æ–‡ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–
                            document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';

                            // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‹ã„ãŸæ™‚ã«å¼·åˆ¶ãƒªãƒšã‚¤ãƒ³ãƒˆ
                            if (sidebar.classList.contains('open')) {
                                requestAnimationFrame(() => {
                                    const computed = window.getComputedStyle(sidebar, '::before').backdropFilter;
                                    sidebar.style.transform = 'translateZ(0.001px)';
                                    requestAnimationFrame(() => {
                                        sidebar.style.transform = '';
                                    });
                                });
                            }
                        }

                        hamburger.addEventListener('click', toggleSidebar);
                        overlay.addEventListener('click', toggleSidebar);

                        // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®transitionçµ‚äº†æ™‚ã«å¼·åˆ¶ãƒªãƒšã‚¤ãƒ³ãƒˆ
                        sidebar.addEventListener('transitionend', function(e) {
                            if (e.propertyName === 'transform' && sidebar.classList.contains('open')) {
                                // transitionçµ‚äº†ç›´å¾Œã«å¼·åˆ¶å†æç”»
                                const computed = window.getComputedStyle(sidebar, '::before').backdropFilter;
                                void sidebar.offsetHeight; // å¼·åˆ¶ãƒªãƒ•ãƒ­ãƒ¼
                            }
                        });

                        // ã‚µã‚¤ãƒ‰ãƒãƒ¼å†…ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯æ™‚ã‚‚é–‰ã˜ã‚‹
                        sidebar.addEventListener('click', function(e) {
                            if (e.target.matches('a')) {
                                setTimeout(() => {
                                    sidebar.classList.remove('open');
                                    overlay.classList.remove('show');
                                    document.body.style.overflow = '';
                                }, 100);
                            }
                        });

                        // backdrop-filteråˆæœŸåŒ–å•é¡Œã®ä¿®æ­£ï¼šå¼·åˆ¶ãƒªãƒšã‚¤ãƒ³ãƒˆ
                        // DOMContentLoadedã§æ—©ã‚ã«å®Ÿè¡Œ
                        document.addEventListener('DOMContentLoaded', function() {
                            // è¤‡æ•°ã®æ–¹æ³•ã§å¼·åˆ¶å†æç”»
                            setTimeout(() => {
                                // æ–¹æ³•1: opacityå¾®èª¿æ•´
                                sidebar.style.opacity = '0.9999';
                                // æ–¹æ³•2: ::beforeã®è¨ˆç®—ã‚¹ã‚¿ã‚¤ãƒ«å–å¾—
                                const computed = window.getComputedStyle(sidebar, '::before').backdropFilter;
                                // æ–¹æ³•3: å¼·åˆ¶ãƒªãƒ•ãƒ­ãƒ¼
                                const forceReflow = sidebar.offsetHeight;

                                requestAnimationFrame(() => {
                                    sidebar.style.opacity = '';
                                });
                            }, 50);
                        });

                        // ã‚µã‚¤ãƒ‰ãƒãƒ¼::beforeã®é«˜ã•ã‚’å‹•çš„ã«èª¿æ•´
                        function updateSidebarBeforeHeight() {
                            const scrollHeight = sidebar.scrollHeight;
                            sidebar.style.setProperty('--sidebar-height', scrollHeight + 'px');
                        }

                        // åˆå›å®Ÿè¡Œ
                        updateSidebarBeforeHeight();

                        // ã‚µã‚¤ãƒ‰ãƒãƒ¼é–‹é–‰æ™‚ã¨ãƒªã‚µã‚¤ã‚ºæ™‚ã«æ›´æ–°
                        hamburger.addEventListener('click', () => {
                            setTimeout(updateSidebarBeforeHeight, 350);
                        });

                        window.addEventListener('resize', updateSidebarBeforeHeight);
                    });
                </script>
            </body>
        </html>
